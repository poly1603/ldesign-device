{"version":3,"file":"useVibration.js","sources":["../../src/composables/useVibration.ts"],"sourcesContent":["/**\r\n * Vue3 Vibration Composable\r\n * \r\n * @example\r\n * ```vue\r\n * <script setup>\r\n * import { useVibration } from '@ldesign/device/vue'\r\n * \r\n * const { vibrate, vibratePattern, stop, isSupported } = useVibration()\r\n * \r\n * function onSuccess() {\r\n *   vibratePattern('success')\r\n * }\r\n * </script>\r\n * ```\r\n */\r\n\r\nimport type { Ref } from 'vue'\r\nimport type { VibrationPatternName } from '@ldesign/device-core'\r\nimport { onUnmounted, ref, readonly } from 'vue'\r\nimport { DeviceDetector } from '@ldesign/device-core'\r\nimport { VibrationModule } from '@ldesign/device-core'\r\n\r\nexport interface UseVibrationReturn {\r\n  /** 是否支持振动 API */\r\n  isSupported: Readonly<Ref<boolean>>\r\n  /** 是否正在振动 */\r\n  isVibrating: Readonly<Ref<boolean>>\r\n  /** 是否已加载模�?*/\r\n  isLoaded: Readonly<Ref<boolean>>\r\n  /** 触发振动 */\r\n  vibrate: (pattern: number | number[]) => boolean\r\n  /** 使用预设模式振动 */\r\n  vibratePattern: (name: VibrationPatternName) => boolean\r\n  /** 停止振动 */\r\n  stop: () => boolean\r\n  /** 获取可用模式 */\r\n  getPatterns: () => VibrationPatternName[]\r\n}\r\n\r\n/**\r\n * Vue3 Vibration Composable\r\n */\r\nexport function useVibration(): UseVibrationReturn {\r\n  const isSupported = ref(false)\r\n  const isVibrating = ref(false)\r\n  const isLoaded = ref(false)\r\n\r\n  let detector: DeviceDetector | null = null\r\n  let module: VibrationModule | null = null\r\n\r\n  const loadModule = async () => {\r\n    if (!detector) {\r\n      detector = new CoreDeviceDetector()\r\n    }\r\n\r\n    try {\r\n      module = await detector.loadModule<VibrationModule>('vibration')\r\n      isSupported.value = module.isSupported()\r\n      isLoaded.value = true\r\n\r\n      // 监听振动事件\r\n      module.on('vibrationStart', () => {\r\n        isVibrating.value = true\r\n      })\r\n\r\n      module.on('vibrationEnd', () => {\r\n        isVibrating.value = false\r\n      })\r\n    }\r\n    catch (error) {\r\n      console.warn('Failed to load vibration module:', error)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  const vibrate = (pattern: number | number[]) => {\r\n    if (!module) {\r\n      console.warn('Module not loaded')\r\n      return false\r\n    }\r\n    return module.vibrate(pattern)\r\n  }\r\n\r\n  const vibratePattern = (name: VibrationPatternName) => {\r\n    if (!module) {\r\n      console.warn('Module not loaded')\r\n      return false\r\n    }\r\n    return module.vibratePattern(name)\r\n  }\r\n\r\n  const stop = () => {\r\n    if (!module) {\r\n      return false\r\n    }\r\n    return module.stop()\r\n  }\r\n\r\n  const getPatterns = () => {\r\n    if (!module) {\r\n      return []\r\n    }\r\n    return module.getAvailablePatterns()\r\n  }\r\n\r\n  // 自动加载模块\r\n  loadModule().catch(() => {\r\n    // 加载失败时静默处�?\n  })\r\n\r\n  onUnmounted(async () => {\r\n    if (module) {\r\n      stop()\r\n    }\r\n    if (detector) {\r\n      await detector.destroy()\r\n      detector = null\r\n      module = null\r\n    }\r\n  })\r\n\r\n  return {\r\n    isSupported: readonly(isSupported),\r\n    isVibrating: readonly(isVibrating),\r\n    isLoaded: readonly(isLoaded),\r\n    vibrate,\r\n    vibratePattern,\r\n    stop,\r\n    getPatterns,\r\n  }\r\n}\r\n\r\n"],"names":["useVibration","isSupported","ref","isVibrating","isLoaded","detector","module","loadModule","CoreDeviceDetector","value","on","error","console","warn","vibrate","pattern","vibratePattern","name","stop","getPatterns","getAvailablePatterns","catch","onUnmounted","destroy","readonly"],"mappings":"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"}