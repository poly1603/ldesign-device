{"version":3,"file":"plugin.js","sources":["../src/plugin.ts"],"sourcesContent":["import type { App, Plugin } from 'vue'\r\nimport { inject } from 'vue'\r\nimport type { DeviceDetector } from '@ldesign/device-core'\r\nimport { DeviceDetector as CoreDeviceDetector } from '@ldesign/device-core'\r\nimport { vDevice } from './directives/vDevice'\r\nimport { DEVICE_INJECTION_KEY } from './constants'\r\n\r\n/**\r\n * Device 插件选项\r\n */\r\nexport interface DevicePluginOptions {\r\n  /** 全局属性名称 */\r\n  globalPropertyName?: string\r\n  /** 是否注册组件 */\r\n  registerComponents?: boolean\r\n  /** 是否注册指令 */\r\n  registerDirectives?: boolean\r\n  /** 设备检测器配置 */\r\n  enableResize?: boolean\r\n  enableOrientation?: boolean\r\n  modules?: string[]\r\n}\r\n\r\n/**\r\n * 创建 Device Vue 插件\r\n *\r\n * @param detector - 设备检测器实例(可选,如果不提供则自动创建)\r\n * @param options - 插件选项\r\n * @returns Vue Plugin\r\n */\r\nexport function createDevicePlugin(\r\n  detector?: DeviceDetector,\r\n  options: DevicePluginOptions = {}\r\n): Plugin {\r\n  const {\r\n    globalPropertyName = '$device',\r\n    registerComponents = true,\r\n    registerDirectives = true,\r\n    enableResize = true,\r\n    enableOrientation = true,\r\n    modules = [],\r\n  } = options\r\n\r\n  return {\r\n    install(app: App) {\r\n      // 创建或使用提供的检测器实例\r\n      const deviceDetector = detector || new CoreDeviceDetector({\r\n        enableResize,\r\n        enableOrientation,\r\n      })\r\n\r\n      // 加载模块\r\n      if (!detector && modules.length > 0) {\r\n        for (const moduleName of modules) {\r\n          deviceDetector.loadModule(moduleName).catch((error) => {\r\n            console.warn(`[Device Plugin] Failed to load module: ${moduleName}`, error)\r\n          })\r\n        }\r\n      }\r\n\r\n      // 注册全局属性\r\n      if (globalPropertyName) {\r\n        app.config.globalProperties[globalPropertyName] = deviceDetector\r\n      }\r\n\r\n      // 提供依赖注入\r\n      app.provide(DEVICE_INJECTION_KEY, deviceDetector)\r\n\r\n      // 注册指令\r\n      if (registerDirectives) {\r\n        app.directive('device', vDevice)\r\n      }\r\n\r\n      // 在应用卸载时清理资源\r\n      const originalUnmount = app.unmount\r\n      app.unmount = function () {\r\n        if (typeof deviceDetector.destroy === 'function') {\r\n          deviceDetector.destroy()\r\n        }\r\n        return originalUnmount.call(this)\r\n      }\r\n    },\r\n  }\r\n}\r\n\r\n/**\r\n * 在组合式 API 中获取设备检测器实例\r\n *\r\n * @returns DeviceDetector 实例\r\n */\r\nexport function useDeviceDetector(): DeviceDetector | null {\r\n  return inject(DEVICE_INJECTION_KEY, null)\r\n}\r\n"],"names":["createDevicePlugin","detector","options","globalPropertyName","registerComponents","registerDirectives","enableResize","enableOrientation","modules","install","app","deviceDetector","CoreDeviceDetector","length","moduleName","loadModule","catch","error","console","warn","config","globalProperties","provide","DEVICE_INJECTION_KEY","directive","vDevice","originalUnmount","unmount","destroy","call","useDeviceDetector","inject"],"mappings":";;;;;;;;;;;;;;;;AA8BO,SAASA,kBAAAA,CACdC,QAAAA,EACAC,OAAAA,GAA+B,EAAC,EACxB;AACR,EAAA,MAAM;AAAA,IACJC,kBAAAA,GAAqB,SAAA;AAAA,IACrBC,kBAAAA,GAAqB,IAAA;AAAA,IACrBC,kBAAAA,GAAqB,IAAA;AAAA,IACrBC,YAAAA,GAAe,IAAA;AAAA,IACfC,iBAAAA,GAAoB,IAAA;AAAA,IACpBC,UAAU;AAAA,GACZ,GAAIN,OAAAA;AAEJ,EAAA,OAAO;AAAA,IACLO,QAAQC,GAAAA,EAAU;AAEhB,MAAA,MAAMC,cAAAA,GAAiBV,QAAAA,IAAY,IAAIW,yBAAAA,CAAmB;AAAA,QACxDN,YAAAA;AAAAA,QACAC;AAAAA,OACD,CAAA;AAGD,MAAA,IAAI,CAACN,QAAAA,IAAYO,OAAAA,CAAQK,MAAAA,GAAS,CAAA,EAAG;AACnC,QAAA,KAAA,MAAWC,cAAcN,OAAAA,EAAS;AAChCG,UAAAA,cAAAA,CAAeI,UAAAA,CAAWD,UAAU,CAAA,CAAEE,KAAAA,CAAOC,CAAAA,KAAAA,KAAU;AACrDC,YAAAA,OAAAA,CAAQC,IAAAA,CAAK,CAAA,uCAAA,EAA0CL,UAAU,CAAA,CAAA,EAAIG,KAAK,CAAA;AAAA,UAC5E,CAAC,CAAA;AAAA,QACH;AAAA,MACF;AAGA,MAAA,IAAId,kBAAAA,EAAoB;AACtBO,QAAAA,GAAAA,CAAIU,MAAAA,CAAOC,gBAAAA,CAAiBlB,kBAAkB,CAAA,GAAIQ,cAAAA;AAAAA,MACpD;AAGAD,MAAAA,GAAAA,CAAIY,OAAAA,CAAQC,gCAAsBZ,cAAc,CAAA;AAGhD,MAAA,IAAIN,kBAAAA,EAAoB;AACtBK,QAAAA,GAAAA,CAAIc,SAAAA,CAAU,UAAUC,eAAO,CAAA;AAAA,MACjC;AAGA,MAAA,MAAMC,kBAAkBhB,GAAAA,CAAIiB,OAAAA;AAC5BjB,MAAAA,GAAAA,CAAIiB,UAAU,WAAY;AACxB,QAAA,IAAI,OAAOhB,cAAAA,CAAeiB,OAAAA,KAAY,UAAA,EAAY;AAChDjB,UAAAA,cAAAA,CAAeiB,OAAAA,EAAQ;AAAA,QACzB;AACA,QAAA,OAAOF,eAAAA,CAAgBG,KAAK,IAAI,CAAA;AAAA,MAClC,CAAA;AAAA,IACF;AAAA,GACF;AACF;AAOO,SAASC,iBAAAA,GAA2C;AACzD,EAAA,OAAOC,UAAAA,CAAOR,gCAAsB,IAAI,CAAA;AAC1C;;;;;;;;"}