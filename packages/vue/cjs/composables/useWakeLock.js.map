{"version":3,"file":"useWakeLock.js","sources":["../../src/composables/useWakeLock.ts"],"sourcesContent":["/**\r\n * Vue3 Wake Lock Composable\r\n * \r\n * @example\r\n * ```vue\r\n * <script setup>\r\n * import { useWakeLock } from '@ldesign/device/vue'\r\n * \r\n * const { isActive, request, release, isSupported } = useWakeLock()\r\n * \r\n * async function playVideo() {\r\n *   await request()\r\n *   video.play()\r\n * }\r\n * </script>\r\n * ```\r\n */\r\n\r\nimport type { Ref } from 'vue'\r\nimport { onUnmounted, ref, readonly } from 'vue'\r\nimport { DeviceDetector } from '@ldesign/device-core'\r\nimport { WakeLockModule } from '@ldesign/device-core'\r\n\r\nexport interface UseWakeLockReturn {\r\n  /** 是否支持 Wake Lock API */\r\n  isSupported: Readonly<Ref<boolean>>\r\n  /** Wake Lock 是否激�?*/\r\n  isActive: Readonly<Ref<boolean>>\r\n  /** 是否已加载模�?*/\r\n  isLoaded: Readonly<Ref<boolean>>\r\n  /** 请求 Wake Lock */\r\n  request: () => Promise<boolean>\r\n  /** 释放 Wake Lock */\r\n  release: () => Promise<void>\r\n  /** 启用自动重新获取 */\r\n  enableAutoReacquire: (enable: boolean) => void\r\n}\r\n\r\n/**\r\n * Vue3 Wake Lock Composable\r\n */\r\nexport function useWakeLock(): UseWakeLockReturn {\r\n  const isSupported = ref(false)\r\n  const isActive = ref(false)\r\n  const isLoaded = ref(false)\r\n\r\n  let detector: DeviceDetector | null = null\r\n  let module: WakeLockModule | null = null\r\n\r\n  const loadModule = async () => {\r\n    if (!detector) {\r\n      detector = new CoreDeviceDetector()\r\n    }\r\n\r\n    try {\r\n      module = await detector.loadModule<WakeLockModule>('wakeLock')\r\n      isSupported.value = module.isSupported()\r\n      isActive.value = module.isActive()\r\n      isLoaded.value = true\r\n\r\n      // 监听事件\r\n      module.on('acquired', () => {\r\n        isActive.value = true\r\n      })\r\n\r\n      module.on('released', () => {\r\n        isActive.value = false\r\n      })\r\n    }\r\n    catch (error) {\r\n      console.warn('Failed to load wake lock module:', error)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  const request = async () => {\r\n    if (!module) {\r\n      await loadModule()\r\n    }\r\n    const success = await module!.requestWakeLock()\r\n    isActive.value = module!.isActive()\r\n    return success\r\n  }\r\n\r\n  const release = async () => {\r\n    if (!module) {\r\n      return\r\n    }\r\n    await module.releaseWakeLock()\r\n    isActive.value = false\r\n  }\r\n\r\n  const enableAutoReacquire = (enable: boolean) => {\r\n    if (!module) {\r\n      console.warn('Module not loaded')\r\n      return\r\n    }\r\n    module.enableAutoReacquire(enable)\r\n  }\r\n\r\n  onUnmounted(async () => {\r\n    if (module) {\r\n      await release()\r\n    }\r\n    if (detector) {\r\n      await detector.destroy()\r\n      detector = null\r\n      module = null\r\n    }\r\n  })\r\n\r\n  return {\r\n    isSupported: readonly(isSupported),\r\n    isActive: readonly(isActive),\r\n    isLoaded: readonly(isLoaded),\r\n    request,\r\n    release,\r\n    enableAutoReacquire,\r\n  }\r\n}\r\n\r\n"],"names":["useWakeLock","isSupported","ref","isActive","isLoaded","detector","module","loadModule","CoreDeviceDetector","value","on","error","console","warn","request","success","requestWakeLock","release","releaseWakeLock","enableAutoReacquire","enable","onUnmounted","destroy","readonly"],"mappings":";;;;;;;;;;;;;AAyCO,SAASA,WAAAA,GAAiC;AAC/C,EAAA,MAAMC,WAAAA,GAAcC,QAAI,KAAK,CAAA;AAC7B,EAAA,MAAMC,QAAAA,GAAWD,QAAI,KAAK,CAAA;AAC1B,EAAA,MAAME,QAAAA,GAAWF,QAAI,KAAK,CAAA;AAE1B,EAAA,IAAIG,QAAAA,GAAkC,IAAA;AACtC,EAAA,IAAIC,MAAAA,GAAgC,IAAA;AAEpC,EAAA,MAAMC,aAAa,YAAY;AAC7B,IAAA,IAAI,CAACF,QAAAA,EAAU;AACbA,MAAAA,QAAAA,GAAW,IAAIG,kBAAAA,EAAmB;AAAA,IACpC;AAEA,IAAA,IAAI;AACFF,MAAAA,MAAAA,GAAS,MAAMD,QAAAA,CAASE,UAAAA,CAA2B,UAAU,CAAA;AAC7DN,MAAAA,WAAAA,CAAYQ,KAAAA,GAAQH,OAAOL,WAAAA,EAAY;AACvCE,MAAAA,QAAAA,CAASM,KAAAA,GAAQH,OAAOH,QAAAA,EAAS;AACjCC,MAAAA,QAAAA,CAASK,KAAAA,GAAQ,IAAA;AAGjBH,MAAAA,MAAAA,CAAOI,EAAAA,CAAG,YAAY,MAAM;AAC1BP,QAAAA,QAAAA,CAASM,KAAAA,GAAQ,IAAA;AAAA,MACnB,CAAC,CAAA;AAEDH,MAAAA,MAAAA,CAAOI,EAAAA,CAAG,YAAY,MAAM;AAC1BP,QAAAA,QAAAA,CAASM,KAAAA,GAAQ,KAAA;AAAA,MACnB,CAAC,CAAA;AAAA,IACH,SACOE,KAAAA,EAAO;AACZC,MAAAA,OAAAA,CAAQC,IAAAA,CAAK,oCAAoCF,KAAK,CAAA;AACtD,MAAA,MAAMA,KAAAA;AAAAA,IACR;AAAA,EACF,CAAA;AAEA,EAAA,MAAMG,UAAU,YAAY;AAC1B,IAAA,IAAI,CAACR,MAAAA,EAAQ;AACX,MAAA,MAAMC,UAAAA,EAAW;AAAA,IACnB;AACA,IAAA,MAAMQ,OAAAA,GAAU,MAAMT,MAAAA,CAAQU,eAAAA,EAAgB;AAC9Cb,IAAAA,QAAAA,CAASM,KAAAA,GAAQH,OAAQH,QAAAA,EAAS;AAClC,IAAA,OAAOY,OAAAA;AAAAA,EACT,CAAA;AAEA,EAAA,MAAME,UAAU,YAAY;AAC1B,IAAA,IAAI,CAACX,MAAAA,EAAQ;AACX,MAAA;AAAA,IACF;AACA,IAAA,MAAMA,OAAOY,eAAAA,EAAgB;AAC7Bf,IAAAA,QAAAA,CAASM,KAAAA,GAAQ,KAAA;AAAA,EACnB,CAAA;AAEA,EAAA,MAAMU,mBAAAA,GAAsBA,CAACC,MAAAA,KAAoB;AAC/C,IAAA,IAAI,CAACd,MAAAA,EAAQ;AACXM,MAAAA,OAAAA,CAAQC,KAAK,mBAAmB,CAAA;AAChC,MAAA;AAAA,IACF;AACAP,IAAAA,MAAAA,CAAOa,oBAAoBC,MAAM,CAAA;AAAA,EACnC,CAAA;AAEAC,EAAAA,eAAAA,CAAY,YAAY;AACtB,IAAA,IAAIf,MAAAA,EAAQ;AACV,MAAA,MAAMW,OAAAA,EAAQ;AAAA,IAChB;AACA,IAAA,IAAIZ,QAAAA,EAAU;AACZ,MAAA,MAAMA,SAASiB,OAAAA,EAAQ;AACvBjB,MAAAA,QAAAA,GAAW,IAAA;AACXC,MAAAA,MAAAA,GAAS,IAAA;AAAA,IACX;AAAA,EACF,CAAC,CAAA;AAED,EAAA,OAAO;AAAA,IACLL,WAAAA,EAAasB,aAAStB,WAAW,CAAA;AAAA,IACjCE,QAAAA,EAAUoB,aAASpB,QAAQ,CAAA;AAAA,IAC3BC,QAAAA,EAAUmB,aAASnB,QAAQ,CAAA;AAAA,IAC3BU,OAAAA;AAAAA,IACAG,OAAAA;AAAAA,IACAE;AAAAA,GACF;AACF;;;;;;;"}