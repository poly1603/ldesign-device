{"version":3,"file":"useMediaCapabilities.js","sources":["../../src/composables/useMediaCapabilities.ts"],"sourcesContent":["/**\r\n * Vue3 媒体能力检�?Composable\r\n * \r\n * @example\r\n * ```vue\r\n * <script setup>\r\n * import { useMediaCapabilities } from '@ldesign/device/vue'\r\n * \r\n * const { checkVideo, getRecommendedQuality, checkHDR } = useMediaCapabilities()\r\n * \r\n * const videoSupport = await checkVideo({\r\n *   contentType: 'video/mp4',\r\n *   width: 1920,\r\n *   height: 1080,\r\n *   bitrate: 5000000,\r\n *   framerate: 30\r\n * })\r\n * </script>\r\n * ```\r\n */\r\n\r\nimport type { Ref } from 'vue'\r\nimport type { MediaCapabilityInfo, MediaConfig } from '@ldesign/device-core'\r\nimport type { HDRSupport } from '@ldesign/device-core'\r\nimport { onUnmounted, ref, readonly } from 'vue'\r\nimport { DeviceDetector } from '@ldesign/device-core'\r\nimport { MediaCapabilitiesModule } from '@ldesign/device-core'\r\n\r\nexport interface UseMediaCapabilitiesReturn {\r\n  /** 是否支持 Media Capabilities API */\r\n  isSupported: Readonly<Ref<boolean>>\r\n  /** 是否已加载模�?*/\r\n  isLoaded: Readonly<Ref<boolean>>\r\n  /** 检测视频解码能�?*/\r\n  checkVideo: (config: MediaConfig) => Promise<MediaCapabilityInfo>\r\n  /** 检测音频解码能�?*/\r\n  checkAudio: (config: MediaConfig) => Promise<MediaCapabilityInfo>\r\n  /** 获取推荐视频质量 */\r\n  getRecommendedQuality: () => Promise<{ resolution: string, bitrate: number, framerate: number }>\r\n  /** 检�?HDR 支持 */\r\n  checkHDR: () => Promise<HDRSupport>\r\n  /** 加载模块 */\r\n  loadModule: () => Promise<void>\r\n  /** 卸载模块 */\r\n  unloadModule: () => Promise<void>\r\n}\r\n\r\n/**\r\n * Vue3 媒体能力检�?Composable\r\n */\r\nexport function useMediaCapabilities(): UseMediaCapabilitiesReturn {\r\n  const isSupported = ref(false)\r\n  const isLoaded = ref(false)\r\n\r\n  let detector: DeviceDetector | null = null\r\n  let module: MediaCapabilitiesModule | null = null\r\n\r\n  const loadModule = async () => {\r\n    if (!detector) {\r\n      detector = new CoreDeviceDetector()\r\n    }\r\n\r\n    try {\r\n      module = await detector.loadModule<MediaCapabilitiesModule>('mediaCapabilities')\r\n      isSupported.value = module.isSupported()\r\n      isLoaded.value = true\r\n    }\r\n    catch (error) {\r\n      console.warn('Failed to load media capabilities module:', error)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  const unloadModule = async () => {\r\n    if (detector) {\r\n      await detector.unloadModule('mediaCapabilities')\r\n      module = null\r\n      isLoaded.value = false\r\n    }\r\n  }\r\n\r\n  const checkVideo = async (config: MediaConfig) => {\r\n    if (!module) {\r\n      await loadModule()\r\n    }\r\n    return module!.checkVideoDecoding(config)\r\n  }\r\n\r\n  const checkAudio = async (config: MediaConfig) => {\r\n    if (!module) {\r\n      await loadModule()\r\n    }\r\n    return module!.checkAudioDecoding(config)\r\n  }\r\n\r\n  const getRecommendedQuality = async () => {\r\n    if (!module) {\r\n      await loadModule()\r\n    }\r\n    return module!.getRecommendedVideoQuality()\r\n  }\r\n\r\n  const checkHDR = async () => {\r\n    if (!module) {\r\n      await loadModule()\r\n    }\r\n    return module!.checkHDRSupport()\r\n  }\r\n\r\n  onUnmounted(async () => {\r\n    if (detector) {\r\n      await detector.destroy()\r\n      detector = null\r\n      module = null\r\n    }\r\n  })\r\n\r\n  return {\r\n    isSupported: readonly(isSupported),\r\n    isLoaded: readonly(isLoaded),\r\n    checkVideo,\r\n    checkAudio,\r\n    getRecommendedQuality,\r\n    checkHDR,\r\n    loadModule,\r\n    unloadModule,\r\n  }\r\n}\r\n\r\n"],"names":["useMediaCapabilities","isSupported","ref","isLoaded","detector","module","loadModule","CoreDeviceDetector","value","error","console","warn","unloadModule","checkVideo","config","checkVideoDecoding","checkAudio","checkAudioDecoding","getRecommendedQuality","getRecommendedVideoQuality","checkHDR","checkHDRSupport","onUnmounted","destroy","readonly"],"mappings":";;;;;;;;;;;;;AAkDO,SAASA,oBAAAA,GAAmD;AACjE,EAAA,MAAMC,WAAAA,GAAcC,QAAI,KAAK,CAAA;AAC7B,EAAA,MAAMC,QAAAA,GAAWD,QAAI,KAAK,CAAA;AAE1B,EAAA,IAAIE,QAAAA,GAAkC,IAAA;AACtC,EAAA,IAAIC,MAAAA,GAAyC,IAAA;AAE7C,EAAA,MAAMC,aAAa,YAAY;AAC7B,IAAA,IAAI,CAACF,QAAAA,EAAU;AACbA,MAAAA,QAAAA,GAAW,IAAIG,kBAAAA,EAAmB;AAAA,IACpC;AAEA,IAAA,IAAI;AACFF,MAAAA,MAAAA,GAAS,MAAMD,QAAAA,CAASE,UAAAA,CAAoC,mBAAmB,CAAA;AAC/EL,MAAAA,WAAAA,CAAYO,KAAAA,GAAQH,OAAOJ,WAAAA,EAAY;AACvCE,MAAAA,QAAAA,CAASK,KAAAA,GAAQ,IAAA;AAAA,IACnB,SACOC,KAAAA,EAAO;AACZC,MAAAA,OAAAA,CAAQC,IAAAA,CAAK,6CAA6CF,KAAK,CAAA;AAC/D,MAAA,MAAMA,KAAAA;AAAAA,IACR;AAAA,EACF,CAAA;AAEA,EAAA,MAAMG,eAAe,YAAY;AAC/B,IAAA,IAAIR,QAAAA,EAAU;AACZ,MAAA,MAAMA,QAAAA,CAASQ,aAAa,mBAAmB,CAAA;AAC/CP,MAAAA,MAAAA,GAAS,IAAA;AACTF,MAAAA,QAAAA,CAASK,KAAAA,GAAQ,KAAA;AAAA,IACnB;AAAA,EACF,CAAA;AAEA,EAAA,MAAMK,UAAAA,GAAa,OAAOC,MAAAA,KAAwB;AAChD,IAAA,IAAI,CAACT,MAAAA,EAAQ;AACX,MAAA,MAAMC,UAAAA,EAAW;AAAA,IACnB;AACA,IAAA,OAAOD,MAAAA,CAAQU,mBAAmBD,MAAM,CAAA;AAAA,EAC1C,CAAA;AAEA,EAAA,MAAME,UAAAA,GAAa,OAAOF,MAAAA,KAAwB;AAChD,IAAA,IAAI,CAACT,MAAAA,EAAQ;AACX,MAAA,MAAMC,UAAAA,EAAW;AAAA,IACnB;AACA,IAAA,OAAOD,MAAAA,CAAQY,mBAAmBH,MAAM,CAAA;AAAA,EAC1C,CAAA;AAEA,EAAA,MAAMI,wBAAwB,YAAY;AACxC,IAAA,IAAI,CAACb,MAAAA,EAAQ;AACX,MAAA,MAAMC,UAAAA,EAAW;AAAA,IACnB;AACA,IAAA,OAAOD,OAAQc,0BAAAA,EAA2B;AAAA,EAC5C,CAAA;AAEA,EAAA,MAAMC,WAAW,YAAY;AAC3B,IAAA,IAAI,CAACf,MAAAA,EAAQ;AACX,MAAA,MAAMC,UAAAA,EAAW;AAAA,IACnB;AACA,IAAA,OAAOD,OAAQgB,eAAAA,EAAgB;AAAA,EACjC,CAAA;AAEAC,EAAAA,eAAAA,CAAY,YAAY;AACtB,IAAA,IAAIlB,QAAAA,EAAU;AACZ,MAAA,MAAMA,SAASmB,OAAAA,EAAQ;AACvBnB,MAAAA,QAAAA,GAAW,IAAA;AACXC,MAAAA,MAAAA,GAAS,IAAA;AAAA,IACX;AAAA,EACF,CAAC,CAAA;AAED,EAAA,OAAO;AAAA,IACLJ,WAAAA,EAAauB,aAASvB,WAAW,CAAA;AAAA,IACjCE,QAAAA,EAAUqB,aAASrB,QAAQ,CAAA;AAAA,IAC3BU,UAAAA;AAAAA,IACAG,UAAAA;AAAAA,IACAE,qBAAAA;AAAAA,IACAE,QAAAA;AAAAA,IACAd,UAAAA;AAAAA,IACAM;AAAAA,GACF;AACF;;;;;;;"}