{"version":3,"file":"useOrientationLock.js","sources":["../../src/composables/useOrientationLock.ts"],"sourcesContent":["/**\r\n * Vue3 Orientation Lock Composable\r\n * \r\n * @example\r\n * ```vue\r\n * <script setup>\r\n * import { useOrientationLock } from '@ldesign/device/vue'\r\n * \r\n * const { \r\n *   lock, \r\n *   unlock, \r\n *   isLocked, \r\n *   currentOrientation \r\n * } = useOrientationLock()\r\n * \r\n * async function playFullscreenVideo() {\r\n *   await lock('landscape')\r\n *   video.requestFullscreen()\r\n * }\r\n * </script>\r\n * ```\r\n */\r\n\r\nimport type { Ref } from 'vue'\r\nimport type { OrientationLockType } from '../../types'\r\nimport { onUnmounted, ref, readonly } from 'vue'\r\nimport { DeviceDetector } from '@ldesign/device-core'\r\nimport { OrientationLockModule } from '@ldesign/device-core'\r\n\r\nexport interface UseOrientationLockReturn {\r\n  /** 是否支持 Screen Orientation API */\r\n  isSupported: Readonly<Ref<boolean>>\r\n  /** 是否已锁定方�?*/\r\n  isLocked: Readonly<Ref<boolean>>\r\n  /** 当前屏幕方向 */\r\n  currentOrientation: Readonly<Ref<string | null>>\r\n  /** 当前屏幕角度 */\r\n  currentAngle: Readonly<Ref<number | null>>\r\n  /** 是否横屏 */\r\n  isLandscape: Readonly<Ref<boolean>>\r\n  /** 是否竖屏 */\r\n  isPortrait: Readonly<Ref<boolean>>\r\n  /** 是否已加载模�?*/\r\n  isLoaded: Readonly<Ref<boolean>>\r\n  /** 锁定屏幕方向 */\r\n  lock: (orientation: OrientationLockType) => Promise<boolean>\r\n  /** 解除锁定 */\r\n  unlock: () => void\r\n  /** 锁定为横�?*/\r\n  lockLandscape: () => Promise<boolean>\r\n  /** 锁定为竖�?*/\r\n  lockPortrait: () => Promise<boolean>\r\n}\r\n\r\n/**\r\n * Vue3 Orientation Lock Composable\r\n */\r\nexport function useOrientationLock(): UseOrientationLockReturn {\r\n  const isSupported = ref(false)\r\n  const isLocked = ref(false)\r\n  const currentOrientation = ref<string | null>(null)\r\n  const currentAngle = ref<number | null>(null)\r\n  const isLandscape = ref(false)\r\n  const isPortrait = ref(false)\r\n  const isLoaded = ref(false)\r\n\r\n  let detector: DeviceDetector | null = null\r\n  let module: OrientationLockModule | null = null\r\n\r\n  const updateOrientationInfo = () => {\r\n    if (!module) return\r\n\r\n    const info = module.getOrientationInfo()\r\n    currentOrientation.value = info.type\r\n    currentAngle.value = info.angle\r\n    isLandscape.value = info.isLandscape\r\n    isPortrait.value = info.isPortrait\r\n    isLocked.value = info.isLocked\r\n  }\r\n\r\n  const loadModule = async () => {\r\n    if (!detector) {\r\n      detector = new CoreDeviceDetector()\r\n    }\r\n\r\n    try {\r\n      module = await detector.loadModule<OrientationLockModule>('orientationLock')\r\n      isSupported.value = module.isSupported()\r\n      isLoaded.value = true\r\n\r\n      // 更新初始状�?\n      updateOrientationInfo()\r\n\r\n      // 监听事件\r\n      module.on('locked', () => {\r\n        isLocked.value = true\r\n      })\r\n\r\n      module.on('unlocked', () => {\r\n        isLocked.value = false\r\n      })\r\n\r\n      module.on('orientationChange', () => {\r\n        updateOrientationInfo()\r\n      })\r\n    }\r\n    catch (error) {\r\n      console.warn('Failed to load orientation lock module:', error)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  const lock = async (orientation: OrientationLockType) => {\r\n    if (!module) {\r\n      await loadModule()\r\n    }\r\n    const success = await module!.lock(orientation)\r\n    updateOrientationInfo()\r\n    return success\r\n  }\r\n\r\n  const unlock = () => {\r\n    if (!module) {\r\n      console.warn('Module not loaded')\r\n      return\r\n    }\r\n    module.unlock()\r\n    updateOrientationInfo()\r\n  }\r\n\r\n  const lockLandscape = async () => {\r\n    return lock('landscape')\r\n  }\r\n\r\n  const lockPortrait = async () => {\r\n    return lock('portrait')\r\n  }\r\n\r\n  onUnmounted(async () => {\r\n    if (module) {\r\n      unlock()\r\n    }\r\n    if (detector) {\r\n      await detector.destroy()\r\n      detector = null\r\n      module = null\r\n    }\r\n  })\r\n\r\n  return {\r\n    isSupported: readonly(isSupported),\r\n    isLocked: readonly(isLocked),\r\n    currentOrientation: readonly(currentOrientation),\r\n    currentAngle: readonly(currentAngle),\r\n    isLandscape: readonly(isLandscape),\r\n    isPortrait: readonly(isPortrait),\r\n    isLoaded: readonly(isLoaded),\r\n    lock,\r\n    unlock,\r\n    lockLandscape,\r\n    lockPortrait,\r\n  }\r\n}\r\n\r\n"],"names":["useOrientationLock","isSupported","ref","isLocked","currentOrientation","currentAngle","isLandscape","isPortrait","isLoaded","detector","module","updateOrientationInfo","info","getOrientationInfo","value","type","angle","loadModule","CoreDeviceDetector","on","error","console","warn","lock","orientation","success","unlock","lockLandscape","lockPortrait","onUnmounted","destroy","readonly"],"mappings":"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"}