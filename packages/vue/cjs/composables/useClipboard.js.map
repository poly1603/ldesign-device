{"version":3,"file":"useClipboard.js","sources":["../../src/composables/useClipboard.ts"],"sourcesContent":["/**\r\n * Vue3 Clipboard Composable\r\n * \r\n * @example\r\n * ```vue\r\n * <script setup>\r\n * import { useClipboard } from '@ldesign/device/vue'\r\n * \r\n * const { writeText, readText, copySuccess } = useClipboard()\r\n * \r\n * async function handleCopy() {\r\n *   const success = await writeText('Hello World')\r\n *   if (success) {\r\n *     console.log('已复�?)\r\n *   }\r\n * }\r\n * </script>\r\n * ```\r\n */\r\n\r\nimport type { Ref } from 'vue'\r\nimport { onUnmounted, ref, readonly } from 'vue'\r\nimport { DeviceDetector } from '@ldesign/device-core'\r\nimport { ClipboardModule } from '@ldesign/device-core'\r\n\r\nexport interface UseClipboardReturn {\r\n  /** 是否支持 Clipboard API */\r\n  isSupported: Readonly<Ref<boolean>>\r\n  /** 是否已加载模�?*/\r\n  isLoaded: Readonly<Ref<boolean>>\r\n  /** 最后一次复制是否成�?*/\r\n  copySuccess: Readonly<Ref<boolean>>\r\n  /** 写入文本到剪贴板 */\r\n  writeText: (text: string) => Promise<boolean>\r\n  /** 从剪贴板读取文本 */\r\n  readText: () => Promise<string | null>\r\n  /** 写入图片到剪贴板 */\r\n  writeImage: (blob: Blob) => Promise<boolean>\r\n  /** 从剪贴板读取图片 */\r\n  readImage: () => Promise<Blob | null>\r\n  /** 复制当前选中文本 */\r\n  copySelection: () => boolean\r\n}\r\n\r\n/**\r\n * Vue3 Clipboard Composable\r\n */\r\nexport function useClipboard(): UseClipboardReturn {\r\n  const isSupported = ref(false)\r\n  const isLoaded = ref(false)\r\n  const copySuccess = ref(false)\r\n\r\n  let detector: DeviceDetector | null = null\r\n  let module: ClipboardModule | null = null\r\n\r\n  const loadModule = async () => {\r\n    if (!detector) {\r\n      detector = new CoreDeviceDetector()\r\n    }\r\n\r\n    try {\r\n      module = await detector.loadModule<ClipboardModule>('clipboard')\r\n      isSupported.value = module.isSupported()\r\n      isLoaded.value = true\r\n\r\n      // 监听事件\r\n      module.on('writeSuccess', () => {\r\n        copySuccess.value = true\r\n      })\r\n\r\n      module.on('error', () => {\r\n        copySuccess.value = false\r\n      })\r\n    }\r\n    catch (error) {\r\n      console.warn('Failed to load clipboard module:', error)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  const writeText = async (text: string) => {\r\n    if (!module) {\r\n      await loadModule()\r\n    }\r\n    const success = await module!.writeText(text)\r\n    copySuccess.value = success\r\n    return success\r\n  }\r\n\r\n  const readText = async () => {\r\n    if (!module) {\r\n      await loadModule()\r\n    }\r\n    return module!.readText()\r\n  }\r\n\r\n  const writeImage = async (blob: Blob) => {\r\n    if (!module) {\r\n      await loadModule()\r\n    }\r\n    const success = await module!.writeImage(blob)\r\n    copySuccess.value = success\r\n    return success\r\n  }\r\n\r\n  const readImage = async () => {\r\n    if (!module) {\r\n      await loadModule()\r\n    }\r\n    return module!.readImage()\r\n  }\r\n\r\n  const copySelection = () => {\r\n    if (!module) {\r\n      console.warn('Module not loaded')\r\n      return false\r\n    }\r\n    const success = module.copySelection()\r\n    copySuccess.value = success\r\n    return success\r\n  }\r\n\r\n  onUnmounted(async () => {\r\n    if (detector) {\r\n      await detector.destroy()\r\n      detector = null\r\n      module = null\r\n    }\r\n  })\r\n\r\n  return {\r\n    isSupported: readonly(isSupported),\r\n    isLoaded: readonly(isLoaded),\r\n    copySuccess: readonly(copySuccess),\r\n    writeText,\r\n    readText,\r\n    writeImage,\r\n    readImage,\r\n    copySelection,\r\n  }\r\n}\r\n\r\n"],"names":["useClipboard","isSupported","ref","isLoaded","copySuccess","detector","module","loadModule","CoreDeviceDetector","value","on","error","console","warn","writeText","text","success","readText","writeImage","blob","readImage","copySelection","onUnmounted","destroy","readonly"],"mappings":"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"}